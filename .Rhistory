API <- "AIzaSyBDaPRvTxmq4eDL4DP97qPwPaiEN0Y2z6c"
library(ggplot)
library(sf)
library(ggmap)
library(tidyverse)
register_google(key = API)
# Base 2016
sinistrosRecife2016Raw <- read.csv2('http://dados.recife.pe.gov.br/dataset/44087d2d-73b5-4ab3-9bd8-78da7436eed1/resource/2caa8f41-ccd9-4ea5-906d-f66017d6e107/download/acidentes_2016-jan.csv', sep = ';', encoding = 'UTF-8')
# Base 2017
sinistrosRecife2017Raw <- read.csv2('http://dados.recife.pe.gov.br/dataset/44087d2d-73b5-4ab3-9bd8-78da7436eed1/resource/2caa8f41-ccd9-4ea5-906d-f66017d6e107/download/acidentes_2017-jan.csv', sep = ';', encoding = 'UTF-8')
# Base 2018
sinistrosRecife2018Raw <- read.csv2('http://dados.recife.pe.gov.br/dataset/44087d2d-73b5-4ab3-9bd8-78da7436eed1/resource/2caa8f41-ccd9-4ea5-906d-f66017d6e107/download/acidentes_2018-jan.csv', sep = ';', encoding = 'UTF-8')
# Base 2019
sinistrosRecife2019Raw <- read.csv2('http://dados.recife.pe.gov.br/dataset/44087d2d-73b5-4ab3-9bd8-78da7436eed1/resource/2caa8f41-ccd9-4ea5-906d-f66017d6e107/download/acidentes_2019-jan.csv', sep = ';', encoding = 'UTF-8')
# Base 2020
sinistrosRecife2020Raw <- read.csv2('http://dados.recife.pe.gov.br/dataset/44087d2d-73b5-4ab3-9bd8-78da7436eed1/resource/fc1c8460-0406-4fff-b51a-e79205d1f1ab/download/acidentes_2020-novo.csv', sep = ';', encoding = 'UTF-8')
# Base 2021
sinistrosRecife2021Raw <- read.csv2('http://dados.recife.pe.gov.br/dataset/44087d2d-73b5-4ab3-9bd8-78da7436eed1/resource/2caa8f41-ccd9-4ea5-906d-f66017d6e107/download/acidentes_2021-jan.csv', sep = ';', encoding = 'UTF-8')
# Join das Bases ----------------------------------------------------------
# junta as bases de dados linha a linha
sinistrosRecifeRaw <- rbind(sinistrosRecife2016Raw,
sinistrosRecife2017Raw,
sinistrosRecife2018Raw,
sinistrosRecife2019Raw,
sinistrosRecife2020Raw,
sinistrosRecife2021Raw)
# ---------------------------------------------------------------------------------------
# observa a estrutura dos dados
str(sinistrosRecifeRaw)
# Read in the CSV data and store it in a variable
#origAddress <- read.csv(fileToLoad, stringsAsFactors = FALSE)
origAddress <- sinistrosRecife
# Read in the CSV data and store it in a variable
#origAddress <- read.csv(fileToLoad, stringsAsFactors = FALSE)
origAddress <- sinistrosRecifeRaw
# Initialize the data frame
geocoded <- data.frame(stringsAsFactors = FALSE)
# Read in the CSV data and store it in a variable
#origAddress <- read.csv(fileToLoad, stringsAsFactors = FALSE)
origAddress <- sinistrosRecifeRaw
# Initialize the data frame
geocoded <- data.frame(stringsAsFactors = FALSE)
result <- geocode(origAddress$endereco[1], output = "latlona", source = "google")
origAddress$lon[1] <- as.numeric(result[1])
origAddress$lat[1] <- as.numeric(result[2])
origAddress$lon[1]
origAddress$lat[1]
# Read in the CSV data and store it in a variable
#origAddress <- read.csv(fileToLoad, stringsAsFactors = FALSE)
SinistrosRecife <- sinistrosRecifeRaw
rm(list=setdiff(ls(), "SinistrosRecife"))
geocoded <- data.frame(stringsAsFactors = FALSE)
sinistrosRecife <- sinistrosRecifeRaw
sinistrosRecife <- SinistrosRecife #sinistrosRecifeRaw
# Limpar a staging area
rm(list=setdiff(ls(), "sinistrosRecife"))
# Geocode dos Endereços ---------------------------------------------------
sinistrosGeocode <- data.frame(stringsAsFactors = FALSE)
# Loop through the addresses to get the latitude and longitude of each address and add it to the
# origAddress data frame in new columns lat and lon
for(i in 1:nrow(sinistrosRecife))
# Loop through the addresses to get the latitude and longitude of each address and add it to the
# origAddress data frame in new columns lat and lon
for(i in 1:nrow(sinistrosRecife)){
Print("Working...")
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
# Loop through the addresses to get the latitude and longitude of each address and add it to the
# origAddress data frame in new columns lat and lon
for(i in 1:nrow(sinistrosRecife)){
print("Working...")
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
View(sinistrosRecife)
View(sinistrosRecife)
sinistrosRecife972 <- sinistrosRecife
for(i in 974:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
sinistrosRecife974_1839 <- sinistrosRecife972 # o 1840 deu erro
#recomeça de onde parou + 1
for(i in 1841:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
sinistrosRecife1841_2021 <- sinistrosRecife # o 2022 deu erro
#recomeça de onde parou + 1
for(i in 2023:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
# o 2358 deu erro
for(i in 2359:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
View(sinistrosRecife1841_2021)
# o 2505 deu erro
for(i in 2506:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
# o 3897 deu erro
for(i in 3898:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
View(sinistrosRecife972)
# o 4139 deu erro
for(i in 4140:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
# o 4387 deu erro
for(i in 4388:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
# o 4549 deu erro
for(i in 4550:nrow(sinistrosRecife)){
result <- geocode(sinistrosRecife$endereco[i], output = "latlona", source = "google")
sinistrosRecife$lon[i] <- as.numeric(result[1])
sinistrosRecife$lat[i] <- as.numeric(result[2])
sinistrosRecife$geoAddress[i] <- as.character(result[3])
}
# Limpar a staging area
rm(list=setdiff(ls(), "sinistrosRecife"))
object.size(sinistrosRecife)
library(rio)
# Write a CSV file containing origAddress to the working directory
export(sinistrosRecife, "sinistrosRecife.rdata")
View(x)
getwd()
setwd("C:/Users/CaioM/github/sinistros_recife")
export(X, "sinistrosRecife.rds")
library(rio)
export(X, "sinistrosRecife.rds")
export(x, "sinistrosRecife.rds")
export(x, "bases_tratadas/sinistrosRecife.rds")
# Limpar a staging area
sinistrosRecife <- x
rm(list=setdiff(ls(), "sinistrosRecife"))
export(sinistrosRecife, "sinistrosRecife.Rdata")
export(sinistrosRecife, "Projeto.Rdata")
# Bibliotecas -------------------------------------------------------------
library(rio)
export(sinistrosRecife, "Projeto.Rdata")
# Limpando a staging area
sinistrosRecife <- x
rm(list=setdiff(ls(), "sinistrosRecife"))
# Cria arquivo .Rdata
export(sinistrosRecife, "bases_tratadas/sinistrosRecife.rds")
export(sinistrosRecife, "Projeto.Rdata")
